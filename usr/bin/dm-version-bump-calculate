#!/bin/bash

## Copyright (C) 2012 - 2023 ENCRYPTED SUPPORT LP <adrelanos@whonix.org>
## See the file COPYING for copying conditions.

# The version string from 'git describe'
git_version="$1"
# example:
#git_version="17.0.5.9-developers-only-129-g41421e68"

# Extract the base version without the build and commit details
base_version="${git_version%-*-*}"

# Split the version into an array using '.' as delimiter
IFS='.' read -r -a version_parts <<< "$base_version"

# Function to increment version
increment_version() {
  local i=$(( ${#version_parts[@]} - 1 ))  # start with the last part of the version
  while [[ $i -ge 0 ]]; do
    if [[ ${version_parts[$i]} -lt 9 ]]; then
      # If part of the version is less than 9, increment it
      ((version_parts[$i]++))
      break
    else
      # If part of the version is 9, set it to 0 and move to the next part
      version_parts[$i]=0
      ((i--))
    fi
  done
}

# Call the function to increment version
increment_version

# Construct the new version
new_version="${version_parts[0]}.${version_parts[1]}.${version_parts[2]}.${version_parts[3]}"

# Output the new version
echo "$new_version"
