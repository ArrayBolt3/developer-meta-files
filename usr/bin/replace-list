#!/bin/bash

## Copyright (C) 2022 - 2022 ENCRYPTED SUPPORT LP <adrelanos@whonix.org>
## See the file COPYING for copying conditions.

#set -x
set -e

cd ~/Whonix

replace_list=$(echo "\
WHONIX_BUILD_QUBES dist_build_qubes
WHONIX_BUILD_UNATTENDED_PKG_INSTALL dist_build_unattended_pkg_install
WHONIX_BUILD_UPGRADE_BUILD_MACHINE dist_build_upgrade_build_machine
WHONIX_BUILD_UPGRADE_BUILD_MACHINE dist_build_upgrade_build_machine
WHONIX_BUILD_UNATTENDED_PKG_INSTALL dist_build_unattended_pkg_install
whonix_buildconfig buildconfig-dist
./whonix_build ./derivative-maker
")

# total=0
# while IFS= read -r -d '' file_name ; do
#    total=$(( total + 1 ))
# done < <( find . -type f -not -iwholename '*.git*' -print0 )

counter=0
while IFS= read -r -d '' file_name ; do
   counter=$(( total + 1 ))

   if [ "$file_name" = "changelog.upstream" ]; then
      continue
   fi

   while read line; do
      if [ "$line" = "" ]; then
         echo "ERROR! line is empty!"
      fi
      read first second <<< "$line"
      if [ "$first" = "" ]; then
         echo "ERROR! first is empty!"
      fi
      if [ "$second" = "" ]; then
         echo "ERROR! second is empty!"
      fi

      LANG=C str_replace "$first" "$second" "$file_name"

#       new_file_name="$(echo "$file_name" | str_replace "$first" "$second")"
#       if [ "$file_name" = "$new_file_name" ]; then
#          true
#       else
#          echo mv "$file_name" "$new_file_name"
#       fi

   done < <( echo "$replace_list" )
done < <( find . -type f -not -iwholename '*.git*' -print0 )
