#!/bin/bash

## Copyright (C) 2022 - 2022 ENCRYPTED SUPPORT LP <adrelanos@whonix.org>
## See the file COPYING for copying conditions.

#set -x
set -e

cd ~/Whonix

replace_list=$(echo "\
packages/Kicksecure/developer-meta-files packages/Kicksecure/developer-meta-files
binary_build_folder_dist binary_build_folder_dist
source_code_folder_dist source_code_folder_dist
dist_parent_folder dist_parent_folder
dist_source_parentdir dist_source_parentdir
dist_source_help_steps_folder dist_source_help_steps_folder
dist_aptgetopt_file dist_aptgetopt_file
dist_build_hostname dist_build_hostname
dist_build_type_long dist_build_type_long
dist_build_type_short dist_build_type_short
dist_build_flavor dist_build_flavor
dist_build_desktop dist_build_desktop
dist_build_install_to_root dist_build_install_to_root
dist_build_unsafe_io dist_build_unsafe_io
dist_build_auto_retry dist_build_auto_retry
dist_build_wait_auto_retry dist_build_wait_auto_retry
dist_sources_list_templ_build_folder dist_sources_list_templ_build_folder
dist_sources_list_temp_initial_deb_sources_list dist_sources_list_temp_initial_deb_sources_list
dist_build_on_operating_system_detect_skip dist_build_on_operating_system_detect_skip
dist_build_on_operating_system dist_build_on_operating_system
dist_build_current_git_head dist_build_current_git_head
dist_unified_name dist_unified_name
dist_build_config_dir dist_build_config_dir
dist_build_config_dirs dist_build_config_dirs
dist_build_source_config_dir dist_build_source_config_dir
dist_build_conf_file dist_build_conf_file
dist_build_sign_local_repository dist_build_sign_local_repository
dist_local_signing_key_folder dist_local_signing_key_folder
dist_build_reprepro_signing_options dist_build_reprepro_signing_options
dist_build_apt_codename dist_build_apt_codename
dist_apt_repository_folder dist_apt_repository_folder
whonix_build_reprepro_folder_options whonix_build_reprepro_folder_options
dist_build_target_arch dist_build_target_arch
dist_build_file_system dist_build_file_system
dist_build_debopt dist_build_debopt
dist_build_pbuilder_chroot_script dist_build_pbuilder_chroot_script
dist_build_pbuilder_config_name dist_build_pbuilder_config_name
dist_build_pbuilder_config_file dist_build_pbuilder_config_file
")

# total=0
# while IFS= read -r -d '' file_name ; do
#    total=$(( total + 1 ))
# done < <( find . -type f -not -iwholename '*.git*' -print0 )

counter=0
while IFS= read -r -d '' file_name ; do
   counter=$(( total + 1 ))
   while read line; do
      if [ "$line" = "" ]; then
         echo "ERROR! line is empty!"
      fi
      read first second <<< "$line"
      if [ "$first" = "" ]; then
         echo "ERROR! first is empty!"
      fi
      if [ "$second" = "" ]; then
         echo "ERROR! second is empty!"
      fi

      LANG=C str_replace "$first" "$second" "$file_name"

#       new_file_name="$(echo "$file_name" | str_replace "$first" "$second")"
#       if [ "$file_name" = "$new_file_name" ]; then
#          true
#       else
#          echo mv "$file_name" "$new_file_name"
#       fi

   done < <( echo "$replace_list" )
done < <( find . -type f -not -iwholename '*.git*' -print0 )
